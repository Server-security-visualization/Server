package com.dca.spring.src.malware;

import com.dca.spring.config.BaseException;
import com.dca.spring.config.BaseResponse;
import com.dca.spring.src.malware.model.*;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import static com.dca.spring.config.BaseResponseStatus.*;

import java.awt.*;
import java.io.IOException;
import java.sql.SQLException;
import java.util.Map;
import java.lang.*;


@RestController
@RequestMapping("/malware")
public class MalController {
    private final MalProvider malProvider;
    private final MalService malService;

    @Autowired
    public MalController(MalProvider malProvider, MalService malService) {
        this.malProvider = malProvider;
        this.malService = malService;
    }

    /** Malware List 조회
     * [GET]
     * /malware/list
     **/
    @GetMapping("/list")
    public BaseResponse<MalListRes> MalList(){
        try{

            MalListRes malListRes = malProvider.MalListPro();
            return new BaseResponse<>(malListRes);

        } catch(BaseException exception){
            return new BaseResponse<>((exception.getStatus()));
        }
    }

    /** Malware 이미지 조회
     * [GET]
     * /malware/detail/img
     **/
    @PostMapping("/detail/{fileIdx}")
    public byte[] MalDetail(@PathVariable int fileIdx) throws BaseException, SQLException, IOException {
        try{
            // 파일 인덱스 입력하지 않았을 때
//            if(malDetailReq.getFile_idx()== null){
//                return new BaseResponse<>(MALWARE_EMPTY_FILE_ID);
//            }
//            int fileIdx = Integer.valueOf(malDetailReq.getFile_idx()).intValue();
//            int fileIdx = Integer.parseInt(malDetailReq.getFile_idx());

            byte[] byteImage = malProvider.ChangeBlobImage(fileIdx);
            return byteImage;

        } catch (BaseException | SQLException | IOException e) {
            e.printStackTrace();
        }
        return new byte[0];
    }
}